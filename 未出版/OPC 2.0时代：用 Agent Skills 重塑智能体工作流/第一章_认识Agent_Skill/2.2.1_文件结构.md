---
section_id: "2.2.1"
title: "文件结构：YAML Frontmatter + Markdown正文"
status: draft
word_count: 0
target_words: 2500
---

# 2.2.1 文件结构：YAML Frontmatter + Markdown正文

## 为什么要这样设计

SKILL.md采用"YAML Frontmatter + Markdown正文"的结构，这种设计并非偶然，而是经过深思熟虑的权衡结果。

**分离元数据与内容**

YAML Frontmatter专门存放机器可解析的元数据——如Skill名称、触发条件、权限配置等。这些信息需要被系统快速读取和处理，而不需要理解自然语言。

Markdown正文则存放人类编写的指令内容——如工作流程、输出规范、示例说明等。这些内容需要AI理解语义，按照描述执行。

这种分离带来了几个好处：
- **快速扫描**：系统只需解析YAML部分就能了解Skill的基本信息
- **清晰分工**：人类专注于写指令，机器专注于解析配置
- **版本友好**：元数据和内容的修改可以独立进行
- **工具支持**：YAML可以被各种工具验证和格式化

**与其他格式的对比**

为什么不使用纯JSON？JSON对机器友好，但对人类编写不友好，尤其是需要写多行文本时。

为什么不使用纯Markdown？Markdown无法标准化地存放结构化元数据。

为什么不使用XML？XML过于冗长，不符合现代开发者的审美和使用习惯。

"YAML + Markdown"的组合在可读性和功能性之间取得了最佳平衡。

## YAML Frontmatter详解

YAML Frontmatter位于文件顶部，用三个连字符`---`包围。

### 基本结构

```yaml
---
name: skill-name
description: When user needs to do something
type: skill
disabled: false
---
```

YAML使用键值对的形式，支持多种数据类型：

**字符串**：
```yaml
name: code-reviewer
description: "When user asks to review code"
```

**布尔值**：
```yaml
disabled: false
user-invocable: true
```

**数字**：
```yaml
max_tokens: 4096
timeout: 30
```

**数组**：
```yaml
allowed-tools:
  - Read
  - Write
  - Bash
```

**对象**：
```yaml
config:
  language: python
  strict: true
```

### YAML语法注意事项

**缩进很重要**：YAML使用缩进表示层级，通常使用2个空格。

```yaml
# 正确
allowed-tools:
  - Read
  - Write

# 错误（使用了Tab）
allowed-tools:
	- Read
	- Write
```

**字符串引号**：

一般情况下字符串不需要引号，但包含特殊字符时需要：

```yaml
# 不需要引号
description: When user asks to review code

# 需要引号（包含冒号）
description: "When user asks: review my code"

# 需要引号（包含特殊字符）
description: "Review code (Python/JavaScript)"
```

**多行字符串**：

使用`|`表示保留换行，使用`>`表示折叠换行：

```yaml
# 保留换行
description: |
  When user asks to review code.
  This includes quality, security,
  and style checks.

# 折叠成一行
description: >
  When user asks to review code.
  This includes quality, security,
  and style checks.
```

### 常见错误

**错误1：缺少结束标记**

```yaml
---
name: my-skill
# 忘记结束标记

## 触发条件
...
```

**错误2：YAML语法错误**

```yaml
---
name: my-skill
description: When user needs help  # 注释不应该在YAML中
allowed-tools: Read, Write  # 应该是数组格式
---
```

**错误3：混用Tab和空格**

```yaml
---
name: my-skill
allowed-tools:
  - Read  # 空格缩进
	- Write  # Tab缩进（错误）
---
```

## Markdown正文详解

YAML Frontmatter之后就是Markdown正文，这是Skill的核心内容。

### 标准结构

一个典型的SKILL.md正文包含三个部分：

```markdown
## 触发条件

说明什么时候激活这个Skill。

## 执行步骤

详细描述Skill的工作流程。

## 输出规范

定义输出结果的格式和内容。
```

### 触发条件

触发条件告诉AI在什么情况下使用这个Skill。它应该：

- 清晰明确，避免模糊表述
- 覆盖主要的触发场景
- 包含示例帮助理解

```markdown
## 触发条件

当用户需要以下任一操作时激活：
- 审查代码质量
- 检查代码安全问题
- 评估代码是否符合最佳实践

**触发示例**：
- "帮我审查这段代码"
- "检查这个函数有没有安全问题"
- "代码走查：app.py"
```

### 执行步骤

执行步骤是Skill的核心，详细描述如何完成任务。

**使用有序列表**：

```markdown
## 执行步骤

1. **读取文件**
   - 使用Read工具读取用户指定的文件
   - 如果文件不存在，提示用户提供正确路径

2. **分析代码**
   - 识别编程语言和技术栈
   - 检查代码复杂度
   - 扫描安全漏洞

3. **生成报告**
   - 汇总发现的问题
   - 按严重程度分类
   - 提供修复建议
```

**使用代码块**：

如果步骤涉及具体的命令或代码，使用代码块：

```markdown
2. **运行测试**
   ```bash
   npm test
   ```
   如果测试失败，读取错误日志并分析原因。
```

**条件判断**：

对于需要条件判断的步骤，明确说明：

```markdown
3. **处理结果**
   - 如果测试通过：继续下一步
   - 如果测试失败：
     - 读取错误信息
     - 分析失败原因
     - 尝试修复（最多重试3次）
```

### 输出规范

输出规范定义Skill应该产生什么样的结果。

**结构化输出**：

```markdown
## 输出格式

审查报告应包含以下部分：

### 1. 概述
- 审查的文件数量
- 发现的问题统计
- 整体质量评级

### 2. 详细发现
对于每个问题：
- **位置**：文件路径和行号
- **严重程度**：错误/警告/建议
- **描述**：问题说明
- **修复建议**：具体的修改方法

### 3. 总结
- 优先级最高的3个问题
- 后续改进建议
```

**示例输出**：

提供示例帮助AI理解期望的输出格式：

```markdown
**示例输出**：

## 代码审查报告

### 概述
- 审查文件：3个
- 发现问题：5个（2错误，2警告，1建议）
- 质量评级：B

### 详细发现

🔴 **错误1**：未处理异常（app.py:45）
- 描述：数据库查询可能抛出异常，但代码中没有try-except块
- 建议：添加异常处理，记录错误日志

🟡 **警告1**：函数过长（utils.py:23）
- 描述：函数calculate()超过50行，建议拆分
...
```

## 完整示例

让我们看一个完整的SKILL.md示例：

```markdown
---
name: python-linter
description: When user asks to check Python code for style and quality issues
type: skill
context: fork
allowed-tools:
  - Read
  - Bash
  - Write
---

## 触发条件

当用户需要检查Python代码时激活，包括：
- 代码风格检查
- 质量评估
- 自动格式化

**触发关键词**：
- "检查这段Python代码"
- "格式化这个文件"
- "Python代码审查"

## 执行步骤

1. **准备环境**
   - 检查是否安装了必要的工具：
     ```bash
     which black pylint mypy
     ```
   - 如果缺少工具，提示用户安装

2. **读取代码**
   - 使用Read工具读取指定的Python文件
   - 验证文件语法是否正确

3. **运行检查**
   - 使用black检查格式：
     ```bash
     black --check {{file_path}}
     ```
   - 使用pylint检查代码质量：
     ```bash
     pylint {{file_path}}
     ```
   - 使用mypy检查类型：
     ```bash
     mypy {{file_path}}
     ```

4. **处理结果**
   - 解析各工具的输出
   - 按问题类型分类
   - 生成统一的报告

5. **自动修复（可选）**
   - 如果用户要求自动修复：
     ```bash
     black {{file_path}}
     ```
   - 显示修改前后的对比

## 输出格式

### 简短报告（默认）
- 文件状态：通过/需改进
- 问题数量统计
- 最严重的前3个问题

### 详细报告（当用户要求时）
完整的检查结果，包括：
- 所有发现的问题
- 具体的修复建议
- 修改后的代码示例

## 示例

**输入**："检查 app.py 的代码质量"

**输出**：
```
## 代码检查报告：app.py

**状态**：⚠️ 需改进

**统计**：
- 格式问题：3处
- 代码质量问题：2处
- 类型问题：1处

**优先级问题**：
1. Line 45: 函数 process_data 缺少类型注解
2. Line 78: 变量名 data 过于简短
3. Line 102: 行长度超过88字符

**建议**：运行 `black app.py` 可自动修复格式问题
```
```

## 编写技巧

**1. 使用明确的标题**

标题应该清晰表达该部分的内容：

```markdown
## 触发条件          ✓ 清晰
## 何时使用          ✓ 清晰
## 条件              ✗ 太模糊
```

**2. 列表优于长段落**

使用列表让步骤更清晰：

```markdown
执行以下步骤：
1. 读取文件
2. 分析内容
3. 生成报告

而不是：

首先你需要读取文件，然后分析内容，最后生成报告...
```

**3. 提供具体示例**

示例比抽象描述更容易理解：

```markdown
不要只说："检查代码风格"

要说："检查代码是否符合PEP 8规范，如变量命名、行长度、导入顺序等"
```

**4. 处理边界情况**

考虑各种可能的边界情况：

```markdown
## 执行步骤

1. **读取文件**
   - 如果文件不存在，提示用户提供正确路径
   - 如果文件为空，报告"空文件，无需检查"
   - 如果文件类型不支持，说明支持的类型
```

**5. 使用强调标记**

使用粗体和斜体突出重要信息：

```markdown
**重要**：在修改文件前，务必确认用户同意
*注意*：此操作不可撤销
```

## 小结

SKILL.md的"YAML Frontmatter + Markdown正文"结构是一种精心设计的文件格式：

- **YAML Frontmatter**：存放机器可解析的元数据配置
- **Markdown正文**：存放人类编写的执行指令

这种分离使得Skill既易于机器处理，又便于人类编写和维护。理解这种结构的原理和最佳实践，是编写高质量Skill的基础。
