---
section_id: 7.2
title: Approval Gatesçš„ä½¿ç”¨
status: draft
target_words: 1500
word_count: 1400
---

# Approval Gatesçš„ä½¿ç”¨

Approval Gatesï¼ˆå®¡æ‰¹é—¨æ§ï¼‰æ˜¯Lobsteræœ€é‡è¦çš„å®‰å…¨ç‰¹æ€§ï¼Œç”¨äºä¿æŠ¤æ•æ„Ÿæ“ä½œã€‚

## ä¸ºä»€ä¹ˆéœ€è¦Approval Gatesï¼Ÿ

### é—®é¢˜åœºæ™¯

```
ä½ è®©AIå¸®ä½ è‡ªåŠ¨å¤„ç†é‚®ä»¶...

AIå†³å®šï¼šè¿™å°é‚®ä»¶çœ‹èµ·æ¥åƒåƒåœ¾é‚®ä»¶ï¼Œåˆ é™¤å®ƒ
      [æ‰§è¡Œåˆ é™¤]

é—®é¢˜ï¼šé‚£å…¶å®æ˜¯ä¸€å°é‡è¦çš„å®¢æˆ·é‚®ä»¶
ç»“æœï¼šé‚®ä»¶è¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸å¯æ¢å¤
```

### è§£å†³æ–¹æ¡ˆ

```
AIå†³å®šï¼šè¿™å°é‚®ä»¶çœ‹èµ·æ¥åƒåƒåœ¾é‚®ä»¶
      [è¯·æ±‚å®¡æ‰¹]

ä½ æ”¶åˆ°é€šçŸ¥ï¼šAIæƒ³åˆ é™¤é‚®ä»¶"æ¥è‡ªCEOçš„ç´§æ€¥é€šçŸ¥"
ä½ é€‰æ‹©ï¼š[æ‰¹å‡†] [æ‹’ç»] [ä¿®æ”¹]

ç»“æœï¼šä½ æŒæ§æœ€ç»ˆå†³å®šæƒ
```

## åŸºæœ¬ç”¨æ³•

### åœ¨æ­¥éª¤ä¸­æ·»åŠ å®¡æ‰¹

```yaml
steps:
  - name: send-email
    tool: shell
    args: ["mail", "-s", "{{subject}}", "boss@company.com"]
    input: "{{body}}"
    approval: required  # å…³é”®é…ç½®
```

### å®¡æ‰¹çº§åˆ«

| çº§åˆ« | è¯´æ˜ |
|-----|------|
| `required` | å¿…é¡»å®¡æ‰¹ |
| `optional` | å¯é€‰å®¡æ‰¹ï¼ˆé»˜è®¤ä¸è§¦å‘ï¼‰ |
| `none` | ä¸éœ€è¦å®¡æ‰¹ï¼ˆé»˜è®¤ï¼‰ |

### é…ç½®å®¡æ‰¹æ¶ˆæ¯

```yaml
steps:
  - name: delete-files
    tool: shell
    args: ["rm", "-rf", "{{directory}}"]
    approval:
      required: true
      message: |
        âš ï¸ å±é™©æ“ä½œ

        å³å°†åˆ é™¤ç›®å½•ï¼š{{directory}}
        æ–‡ä»¶æ•°é‡ï¼š{{file-count}}
        æ€»å¤§å°ï¼š{{total-size}}

        æ­¤æ“ä½œä¸å¯æ¢å¤ï¼
```

## å®¡æ‰¹æµç¨‹

### æµç¨‹å›¾

```
å·¥ä½œæµæ‰§è¡Œ â”€â”€â”€â”€> é‡åˆ°approval: requiredçš„æ­¥éª¤
                            â”‚
                            â†“
                    æš‚åœå·¥ä½œæµæ‰§è¡Œ
                            â”‚
                            â†“
                    ç”Ÿæˆæ¢å¤ä»¤ç‰Œ (Resume Token)
                            â”‚
                            â†“
                    é€šçŸ¥ç”¨æˆ·å®¡æ‰¹
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â†“                       â†“
            [æ‰¹å‡†]                   [æ‹’ç»]
                â”‚                       â”‚
                â†“                       â†“
        ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥              ç»ˆæ­¢å·¥ä½œæµ
```

### å®¡æ‰¹é€šçŸ¥

å½“å·¥ä½œæµéœ€è¦å®¡æ‰¹æ—¶ï¼Œä½ ä¼šæ”¶åˆ°é€šçŸ¥ï¼š

```
ğŸ”” å·¥ä½œæµå®¡æ‰¹è¯·æ±‚

å·¥ä½œæµ: email-cleanup
æ­¥éª¤: delete-emails
æè¿°: åˆ é™¤å·²åˆ†ç±»çš„åƒåœ¾é‚®ä»¶

è¯¦æƒ…:
- å¾…åˆ é™¤é‚®ä»¶: 23 å°
- é¢„è®¡é‡Šæ”¾ç©ºé—´: 15.3 MB

å®¡æ‰¹ä»¤ç‰Œ: ABC123

[æ‰¹å‡†] [æ‹’ç»] [æŸ¥çœ‹è¯¦æƒ…]
```

## å®¡æ‰¹æ–¹å¼

### æ–¹å¼ä¸€ï¼šèŠå¤©ä¸­å®¡æ‰¹

```
ä½ ï¼šæ‰¹å‡†åˆ é™¤é‚®ä»¶
AIï¼šå·²æ‰¹å‡† delete-emails æ­¥éª¤
    å·¥ä½œæµç»§ç»­æ‰§è¡Œ...
```

### æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œå®¡æ‰¹

```bash
# æŸ¥çœ‹å¾…å®¡æ‰¹é¡¹
openclaw lobster pending

# æ‰¹å‡†
openclaw lobster approve ABC123

# æ‹’ç»
openclaw lobster reject ABC123
```

### æ–¹å¼ä¸‰ï¼šDashboardå®¡æ‰¹

1. æ‰“å¼€ http://127.0.0.1:18789
2. è¿›å…¥ Lobster > Pending
3. ç‚¹å‡» Approve æˆ– Reject

## é«˜çº§é…ç½®

### å®¡æ‰¹è¶…æ—¶

```yaml
steps:
  - name: critical-action
    tool: shell
    args: ["./deploy.sh"]
    approval:
      required: true
      timeout: 1h        # 1å°æ—¶åè‡ªåŠ¨æ‹’ç»
      onTimeout: reject  # æˆ– continueï¼ˆç»§ç»­æ‰§è¡Œï¼‰
```

### å®¡æ‰¹é€šçŸ¥æ¸ é“

```yaml
steps:
  - name: send-money
    tool: shell
    args: ["./payment.sh", "--amount", "{{amount}}"]
    approval:
      required: true
      notify:
        - telegram       # å‘é€åˆ°Telegram
        - slack:#alerts  # å‘é€åˆ°Slacké¢‘é“
        - email:user@company.com
```

### å¤šäººå®¡æ‰¹

```yaml
steps:
  - name: deploy-production
    tool: shell
    args: ["./deploy.sh", "production"]
    approval:
      required: true
      approvers:
        - user-1  # ç”¨æˆ·1
        - user-2  # ç”¨æˆ·2
      minApprovals: 2  # éœ€è¦è‡³å°‘2äººæ‰¹å‡†
```

## ä½•æ—¶ä½¿ç”¨Approval Gates

### éœ€è¦å®¡æ‰¹çš„æ“ä½œ

| æ“ä½œç±»å‹ | ç¤ºä¾‹ | åŸå›  |
|---------|------|------|
| äº§ç”Ÿå‰¯ä½œç”¨ | å‘é€é‚®ä»¶ã€å‘å¸– | ä¸å¯æ’¤é”€ |
| æ¶‰åŠèµ„é‡‘ | æ”¯ä»˜ã€è½¬è´¦ | é£é™©é«˜ |
| ç ´åæ€§æ“ä½œ | åˆ é™¤æ–‡ä»¶ | ä¸å¯æ¢å¤ |
| ä¿®æ”¹é…ç½® | ä¿®æ”¹ç³»ç»Ÿè®¾ç½® | å½±å“èŒƒå›´å¤§ |
| å¤–éƒ¨äº¤äº’ | è°ƒç”¨å¤–éƒ¨API | ä¸å¯æ§ |

### ä¸éœ€è¦å®¡æ‰¹çš„æ“ä½œ

| æ“ä½œç±»å‹ | ç¤ºä¾‹ | åŸå›  |
|---------|------|------|
| åªè¯»æ“ä½œ | è¯»å–æ–‡ä»¶ã€æŸ¥è¯¢ | æ— å‰¯ä½œç”¨ |
| æœ¬åœ°å¤„ç† | æ•°æ®è½¬æ¢ | é£é™©ä½ |
| ä¸´æ—¶æ“ä½œ | åˆ›å»ºä¸´æ—¶æ–‡ä»¶ | å¯æ¢å¤ |

## å®æˆ˜ç¤ºä¾‹

### é‚®ä»¶å‘é€å®¡æ‰¹

```yaml
name: send-report

steps:
  - name: generate-report
    tool: python
    script: |
      import openai

      response = openai.chat.completions.create(
        model="gpt-4",
        messages=[{"role": "user", "content": "ç”Ÿæˆå‘¨æŠ¥..."}]
      )

      print(response.choices[0].message.content)

  - name: send-email
    tool: shell
    args: ["mail", "-s", "æœ¬å‘¨å‘¨æŠ¥", "team@company.com"]
    input: "{{generate-report.output}}"
    approval:
      required: true
      message: |
        ğŸ“§ é‚®ä»¶å‘é€ç¡®è®¤

        æ”¶ä»¶äºº: team@company.com
        ä¸»é¢˜: æœ¬å‘¨å‘¨æŠ¥

        è¯·ç¡®è®¤é‚®ä»¶å†…å®¹æ— è¯¯åå‘é€ã€‚
```

### æ–‡ä»¶åˆ é™¤å®¡æ‰¹

```yaml
name: cleanup-downloads

steps:
  - name: list-old-files
    tool: shell
    args: ["find", "~/Downloads", "-mtime", "+30"]

  - name: confirm-delete
    tool: python
    script: |
      import subprocess

      files = """{{list-old-files.output}}"""
      file_list = [f for f in files.split('\n') if f]

      # ç»Ÿè®¡æ–‡ä»¶æ•°é‡å’Œæ€»å¤§å°
      count = len(file_list)
      total_size = 0
      for f in file_list:
        try:
          size = subprocess.check_output(["stat", "-f%z", f]).decode().strip()
          total_size += int(size)
        except:
          pass

      import json
      print(json.dumps({"count": count, "size": f"{total_size / 1024 / 1024:.1f} MB"}))

  - name: delete-files
    tool: shell
    args: ["rm", "-rf", "{{list-old-files.output}}"]
    approval:
      required: true
      message: |
        ğŸ—‘ï¸ æ–‡ä»¶åˆ é™¤ç¡®è®¤

        å°†åˆ é™¤ {{confirm-delete.output.count}} ä¸ªæ–‡ä»¶
        é‡Šæ”¾ç©ºé—´ï¼š{{confirm-delete.output.size}}

        æ­¤æ“ä½œä¸å¯æ¢å¤ï¼
```

### ç”Ÿäº§éƒ¨ç½²å®¡æ‰¹

```yaml
name: deploy-production

steps:
  - name: run-tests
    tool: shell
    args: ["npm", "test"]

  - name: deploy
    tool: shell
    args: ["./deploy.sh", "production"]
    approval:
      required: true
      timeout: 2h
      approvers:
        - tech-lead
        - ops-manager
      minApprovals: 1
      message: |
        ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¯·æ±‚

        åˆ†æ”¯: main
        æäº¤: {{git-commit}}
        æµ‹è¯•: âœ“ é€šè¿‡

        è¯·ç¡®è®¤éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚
```

---

**æœ¬èŠ‚å°ç»“**

- Approval Gatesä¸ºæ•æ„Ÿæ“ä½œå¢åŠ äººå·¥ç¡®è®¤
- ä½¿ç”¨ `approval: required` å¯ç”¨å®¡æ‰¹
- å¯é€šè¿‡èŠå¤©ã€å‘½ä»¤è¡Œã€Dashboardå®¡æ‰¹
- æ”¯æŒè¶…æ—¶ã€å¤šæ¸ é“é€šçŸ¥ã€å¤šäººå®¡æ‰¹
- äº§ç”Ÿå‰¯ä½œç”¨çš„æ“ä½œéƒ½åº”è¯¥å¯ç”¨å®¡æ‰¹
