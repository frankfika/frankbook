---
section_id: 9.3
title: 文档处理与报告生成
status: draft
target_words: 2000
word_count: 2150
---

# 文档处理与报告生成

文档处理和报告生成是知识工作者日常工作的重要组成部分。无论是撰写周报、整理会议纪要、生成数据分析报告，还是处理合同、发票等商务文档，都需要耗费大量时间和精力。OpenClaw 可以帮助我们构建一个智能文档助手，实现文档的自动处理、内容提取、格式转换和智能生成，大幅提升文档工作效率。

## 场景介绍

### 文档处理的常见挑战

1. **格式转换繁琐**：不同系统间的文档格式不兼容，需要频繁转换
2. **信息提取困难**：从大量文档中提取关键信息耗时耗力
3. **报告撰写重复**：周报、月报等周期性报告内容重复性高
4. **格式统一困难**：团队文档风格不一致，难以维护专业形象
5. **版本管理混乱**：文档多次修改后难以追踪变更历史

### OpenClaw 的解决方案

- **智能提取**：自动从各类文档中提取关键信息和数据
- **格式转换**：支持多种文档格式之间的自动转换
- **模板填充**：基于模板自动生成标准化文档
- **内容生成**：根据数据和指令自动生成报告内容
- **质量检查**：自动检查文档格式、语法、一致性

## 实现思路

智能文档处理系统的核心组件包括：

1. **文档解析器**：支持 PDF、Word、Excel、Markdown 等多种格式的解析
2. **信息提取器**：使用 NLP 技术从文档中提取结构化信息
3. **模板引擎**：支持变量替换、条件渲染、循环等模板功能
4. **内容生成器**：基于 AI 生成文档内容，支持多种写作风格
5. **格式转换器**：在不同文档格式之间进行转换

## 配置步骤

### 第一步：创建文档处理 Skill

```yaml
# ~/.openclaw/skills/document/SKILL.md
---
name: document-processor
description: 文档处理助手
commands:
  - name: extract-pdf
    description: 从 PDF 提取文本
    script: |
      python3 -c "
import pdfplumber
import json
import sys

with pdfplumber.open('{{file_path}}') as pdf:
    text = '\n'.join([page.extract_text() for page in pdf.pages if page.extract_text()])
    tables = []
    for page in pdf.pages:
        tables.extend(page.extract_tables())

print(json.dumps({'text': text, 'tables': tables, 'pages': len(pdf.pages)}))
"

  - name: extract-word
    description: 从 Word 文档提取内容
    script: |
      python3 -c "
from docx import Document
import json

doc = Document('{{file_path}}')
paragraphs = [p.text for p in doc.paragraphs if p.text.strip()]
tables = []
for table in doc.tables:
    table_data = []
    for row in table.rows:
        table_data.append([cell.text for cell in row.cells])
    tables.append(table_data)

print(json.dumps({'paragraphs': paragraphs, 'tables': tables}))
"

  - name: generate-report
    description: 生成报告文档
    script: |
      python3 -c "
from docx import Document
from docx.shared import Inches, Pt
from docx.enum.text import WD_ALIGN_PARAGRAPH
import json

doc = Document()

# 添加标题
title = doc.add_heading('{{title}}', 0)
title.alignment = WD_ALIGN_PARAGRAPH.CENTER

# 添加元信息
doc.add_paragraph('生成日期: {{date}}')
doc.add_paragraph('报告人: {{author}}')
doc.add_paragraph()

# 添加内容
content = '''{{content}}'''
doc.add_heading('报告正文', 1)
doc.add_paragraph(content)

# 保存
doc.save('{{output_path}}')
print(json.dumps({'status': 'success', 'path': '{{output_path}}'}))
"

  - name: convert-to-pdf
    description: 转换为 PDF
    script: |
      libreoffice --headless --convert-to pdf --outdir "{{output_dir}}" "{{input_file}}"

  - name: merge-documents
    description: 合并多个文档
    script: |
      python3 -c "
from docx import Document
import json

merged = Document()
files = {{files | to_json}}

for file_path in files:
    doc = Document(file_path)
    for element in doc.element.body:
        merged.element.body.append(element)
    merged.add_page_break()

merged.save('{{output_path}}')
print(json.dumps({'status': 'success', 'merged_files': len(files)}))
"
```

### 第二步：创建文档分析 Agent

```yaml
# ~/.openclaw/agents/document-analyzer.yaml
name: document-analyzer
description: 文档内容分析专家
system_prompt: |
  你是一位专业的文档分析师，擅长从各类文档中提取关键信息和洞察。

  分析能力：
  1. 提取关键数据点和指标
  2. 识别主要观点和结论
  3. 发现潜在问题和风险
  4. 总结行动项和待办事项
  5. 评估文档质量和完整性

  输出要求：
  - 结构化输出，便于后续处理
  - 标注数据来源和置信度
  - 提供可操作的建议

  输出格式（JSON）：
  {
    "summary": "文档摘要",
    "key_metrics": [{"name": "指标名", "value": "值", "context": "上下文"}],
    "main_points": ["要点1", "要点2"],
    "action_items": [{"task": "任务", "owner": "负责人", "deadline": "截止日期"}],
    "risks": ["风险1", "风险2"],
    "quality_score": 8.5,
    "suggestions": ["改进建议1"]
  }
```

### 第三步：编写文档处理工作流

```yaml
# ~/.openclaw/workflows/document-processor.lobster
name: document-processor
version: "1.0"

triggers:
  - type: webhook
    path: "/document/upload"
  - type: schedule
    cron: "0 9 * * 1"  # 每周一早上9点生成周报

steps:
  # 1. 解析上传的文档
  - name: parse_document
    skill: document-processor
    command: |
      {% if input.file_type == 'pdf' %}
        extract-pdf
      {% elif input.file_type == 'docx' %}
        extract-word
      {% endif %}
    args:
      file_path: "{{input.file_path}}"

  # 2. 分析文档内容
  - name: analyze_content
    agent: document-analyzer
    prompt: |
      请分析以下文档内容：
      {{steps.parse_document.output.text}}

      文档类型：{{input.document_type}}
      分析目的：{{input.analysis_purpose}}

  # 3. 提取结构化数据
  - name: extract_data
    agent: data-extractor
    prompt: |
      从以下文档中提取结构化数据：
      {{steps.parse_document.output}}

      需要提取的字段：
      {{input.required_fields}}

      输出为 JSON 格式。

  # 4. 存储到数据库
  - name: save_to_db
    skill: database
    command: insert
    args:
      table: "{{input.target_table}}"
      data: "{{steps.extract_data.output}}"

  # 5. 生成处理报告
  - name: generate_report
    agent: report-writer
    prompt: |
      基于以下分析结果生成处理报告：
      文档：{{input.file_name}}
      分析结果：{{steps.analyze_content.output}}
      提取数据：{{steps.extract_data.output}}

      请生成一份简洁的处理报告，包括：
      1. 文档概览
      2. 关键发现
      3. 提取的数据统计
      4. 后续建议

  # 6. 通知用户
  - name: notify_user
    skill: notification
    command: send
    args:
      channel: "{{user.preferences.notification_channel}}"
      title: "文档处理完成：{{input.file_name}}"
      content: "{{steps.generate_report.output}}"
```

### 第四步：配置报告模板

```yaml
# ~/.openclaw/templates/weekly-report.yaml
name: weekly-report
description: 周报模板
format: docx

sections:
  - name: "本周工作总结"
    type: "bullet_list"
    source: "{{work_items.this_week}}"
    template: "- {{item.title}}：{{item.description}}（完成度：{{item.progress}}%）"

  - name: "下周工作计划"
    type: "numbered_list"
    source: "{{work_items.next_week}}"
    template: "{{index}}. {{item.title}} - 预计完成时间：{{item.estimated_time}}"

  - name: "问题与风险"
    type: "table"
    headers: ["问题描述", "影响程度", "解决方案", "负责人"]
    source: "{{issues}}"

  - name: "数据指标"
    type: "metrics"
    items:
      - label: "完成任务数"
        value: "{{metrics.completed_tasks}}"
      - label: "代码提交数"
        value: "{{metrics.commits}}"
      - label: "Bug修复数"
        value: "{{metrics.bugs_fixed}}"

  - name: "需要协调的事项"
    type: "checklist"
    source: "{{coordination_items}}"

# 样式配置
styles:
  title:
    font: "Microsoft YaHei"
    size: 18
    bold: true
    alignment: center
  heading:
    font: "Microsoft YaHei"
    size: 14
    bold: true
  body:
    font: "Microsoft YaHei"
    size: 11
    line_spacing: 1.5
```

## 实际案例

### 案例一：自动周报生成

项目经理小张每周需要花费2小时写周报，使用 OpenClaw 实现自动化：

```yaml
name: auto-weekly-report

triggers:
  - type: schedule
    cron: "0 17 * * 5"  # 每周五下午5点

steps:
  # 1. 从项目管理工具获取数据
  - name: fetch_jira_data
    skill: jira
    command: get-weekly-activity
    args:
      user: "{{user.email}}"
      week_start: "{{this_week_start}}"
      week_end: "{{this_week_end}}"

  # 2. 从代码仓库获取提交记录
  - name: fetch_git_commits
    skill: git
    command: get-commits
    args:
      author: "{{user.name}}"
      since: "{{this_week_start}}"
      until: "{{this_week_end}}"

  # 3. 从日历获取会议记录
  - name: fetch_meetings
    skill: calendar
    command: get-events
    args:
      start: "{{this_week_start}}"
      end: "{{this_week_end}}"

  # 4. 汇总工作内容
  - name: summarize_work
    agent: report-writer
    prompt: |
      基于以下数据生成本周工作总结：

      JIRA 活动：
      {{steps.fetch_jira_data.output}}

      Git 提交：
      {{steps.fetch_git_commits.output}}

      参加会议：
      {{steps.fetch_meetings.output}}

      请生成：
      1. 本周完成的主要工作（按项目分类）
      2. 关键成果和里程碑
      3. 遇到的挑战和解决方案

  # 5. 生成下周计划
  - name: plan_next_week
    agent: planner
    prompt: |
      基于本周工作和待办事项，生成下周计划：
      本周完成：{{steps.summarize_work.output}}
      待办事项：{{user.backlog}}

      请生成优先级排序的下周工作计划。

  # 6. 填充报告模板
  - name: generate_document
    skill: document-processor
    command: generate-from-template
    args:
      template: "weekly-report"
      data:
        work_items:
          this_week: "{{steps.summarize_work.output}}"
          next_week: "{{steps.plan_next_week.output}}"
        metrics:
          completed_tasks: "{{steps.fetch_jira_data.output.completed | length}}"
          commits: "{{steps.fetch_git_commits.output | length}}"
        author: "{{user.name}}"
        date: "{{today}}"
      output_path: "/reports/weekly-{{today}}.docx"

  # 7. 转换为 PDF 并发送
  - name: convert_to_pdf
    skill: document-processor
    command: convert-to-pdf
    args:
      input_file: "/reports/weekly-{{today}}.docx"
      output_dir: "/reports/"

  - name: send_report
    skill: notification
    command: send-email
    args:
      to: "{{user.manager_email}}"
      cc: "{{user.team_email}}"
      subject: "周报 - {{user.name}} - {{this_week}}"
      body: |
        领导好，

        附件是我的本周工作周报，请查收。

        本周主要完成了：
        {{steps.summarize_work.output | truncate: 200}}

        如有任何问题，请随时联系。

        {{user.name}}
      attachments:
        - "/reports/weekly-{{today}}.pdf"
```

### 案例二：合同审查助手

法务助理小李需要处理大量合同，使用 OpenClaw 提高效率：

```yaml
name: contract-review-assistant

triggers:
  - type: webhook
    path: "/contract/upload"

steps:
  - name: extract_contract
    skill: document-processor
    command: extract-pdf
    args:
      file_path: "{{input.file_path}}"

  - name: analyze_contract
    agent: legal-assistant
    prompt: |
      请审查以下合同内容，识别关键条款和潜在风险：
      {{steps.extract_contract.output.text}}

      请重点关注：
      1. 付款条款（金额、时间、方式）
      2. 交付条款（时间、标准、验收）
      3. 违约责任
      4. 保密条款
      5. 争议解决
      6. 与标准模板的差异

      输出格式：
      - 合同类型
      - 关键条款摘要
      - 风险提示（高/中/低）
      - 建议修改事项
      - 审批建议（通过/有条件通过/驳回）

  - name: check_against_template
    skill: document-processor
    command: compare-documents
    args:
      doc1: "{{input.file_path}}"
      doc2: "{{company.standard_templates[input.contract_type]}}"

  - name: generate_review_report
    skill: document-processor
    command: generate-report
    args:
      title: "合同审查报告 - {{input.contract_name}}"
      content: |
        ## 合同信息
        - 合同名称：{{input.contract_name}}
        - 对方当事人：{{steps.analyze_contract.output.counterparty}}
        - 合同金额：{{steps.analyze_contract.output.amount}}

        ## 审查结果
        {{steps.analyze_contract.output}}

        ## 与标准模板对比
        {{steps.check_against_template.output.differences}}

        ## 审批建议
        {{steps.analyze_contract.output.recommendation}}
      output_path: "/contracts/reviews/{{input.contract_name}}-review.docx"

  - name: notify_legal
    skill: notification
    command: send
    condition: "{{steps.analyze_contract.output.risk_level == 'high'}}"
    args:
      channel: "email"
      to: "{{user.legal_team_email}}"
      subject: "高风险合同待审批：{{input.contract_name}}"
      content: |
        检测到高风险合同，请优先处理。

        风险摘要：
        {{steps.analyze_contract.output.risks | format_list}}

        完整审查报告：{{steps.generate_review_report.output.path}}
```

### 案例三：数据分析报告自动生成

数据分析师小王需要定期生成业务报告：

```yaml
name: auto-data-report

triggers:
  - type: schedule
    cron: "0 9 1 * *"  # 每月1号早上9点

steps:
  # 1. 从数据库获取数据
  - name: fetch_sales_data
    skill: database
    command: query
    args:
      sql: |
        SELECT
          DATE_TRUNC('month', order_date) as month,
          SUM(amount) as revenue,
          COUNT(*) as orders,
          AVG(amount) as avg_order_value
        FROM orders
        WHERE order_date >= '{{last_month_start}}'
          AND order_date < '{{this_month_start}}'
        GROUP BY DATE_TRUNC('month', order_date)

  - name: fetch_user_metrics
    skill: database
    command: query
    args:
      sql: |
        SELECT
          COUNT(DISTINCT user_id) as active_users,
          COUNT(DISTINCT CASE WHEN last_login >= '{{last_month_start}}' THEN user_id END) as retained_users
        FROM users
        WHERE created_at < '{{this_month_start}}'

  # 2. 数据分析
  - name: analyze_trends
    agent: data-analyst
    prompt: |
      分析以下业务数据，生成洞察：

      销售数据：
      {{steps.fetch_sales_data.output}}

      用户数据：
      {{steps.fetch_user_metrics.output}}

      请提供：
      1. 关键指标同比/环比变化
      2. 趋势分析（上升/下降/平稳）
      3. 异常点识别
      4. 可能的原因分析
      5. 下月预测和建议

  # 3. 生成可视化图表
  - name: generate_charts
    skill: visualization
    command: create-charts
    args:
      data: "{{steps.fetch_sales_data.output}}"
      charts:
        - type: "line"
          title: "月度收入趋势"
          x: "month"
          y: "revenue"
        - type: "bar"
          title: "订单量对比"
          x: "month"
          y: "orders"

  # 4. 生成报告文档
  - name: generate_report
    skill: document-processor
    command: generate-report
    args:
      title: "{{last_month}}月度业务报告"
      author: "{{user.name}}"
      date: "{{today}}"
      content: |
        ## 执行摘要
        {{steps.analyze_trends.output.summary}}

        ## 关键指标
        {{steps.fetch_sales_data.output | format_table}}

        ## 趋势分析
        {{steps.analyze_trends.output.trend_analysis}}

        ## 详细数据
        {{steps.fetch_sales_data.output | format_detailed}}

        ## 建议措施
        {{steps.analyze_trends.output.recommendations}}

        ## 图表
        {{steps.generate_charts.output | embed_images}}
      output_path: "/reports/monthly-{{last_month}}.docx"

  # 5. 分发报告
  - name: distribute_report
    skill: notification
    command: send-email
    args:
      to: "{{user.stakeholders}}"
      subject: "{{last_month}}月度业务报告"
      body: |
        各位好，

        {{last_month}}月度业务报告已生成，请查收附件。

        本月亮点：
        {{steps.analyze_trends.output.highlights | format_list}}

        完整报告请查看附件。
      attachments:
        - "/reports/monthly-{{last_month}}.docx"
```

## 进阶技巧

### 批量文档处理

```yaml
- name: batch_process
  skill: document-processor
  command: batch-extract
  loop:
    over: "{{input.files}}"
    parallel: true
    max_workers: 5
  args:
    file: "{{item}}"
    extraction_rules: "{{user.extraction_rules}}"

- name: consolidate_results
  agent: data-processor
  prompt: |
    汇总以下文档提取结果：
    {{steps.batch_process.output}}

    请生成统一的汇总表格，并识别跨文档的模式和异常。
```

### 智能文档比对

```yaml
- name: compare_versions
  skill: document-processor
  command: diff-documents
  args:
    old_version: "{{input.old_file}}"
    new_version: "{{input.new_file}}"

- name: summarize_changes
  agent: document-analyzer
  prompt: |
    基于以下文档差异，生成变更摘要：
    {{steps.compare_versions.output}}

    请识别：
    1. 重大变更
    2. 新增内容
    3. 删除内容
    4. 修改影响评估
```

通过这些配置，OpenClaw 可以成为你的智能文档助手，帮你从繁琐的文档工作中解放出来，专注于更有价值的创造性工作。
