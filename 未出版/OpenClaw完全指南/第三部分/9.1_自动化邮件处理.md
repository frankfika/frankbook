---
section_id: 9.1
title: 自动化邮件处理
status: draft
target_words: 1500
word_count: 1580
---

# 自动化邮件处理

电子邮件是现代工作中最重要的沟通工具之一，但也常常成为效率的杀手。据统计，知识工作者平均每天花费2-3小时处理邮件，其中大部分是重复性工作：筛选重要邮件、回复常见问题、归档整理等。OpenClaw 可以帮助我们构建一个智能邮件助手，实现邮件的自动分类、智能回复、跟进提醒等功能，让我们从邮件的海洋中解放出来。

## 场景介绍

### 邮件处理的常见痛点

1. **收件箱过载**：每天收到数十甚至上百封邮件，难以快速识别重要信息
2. **回复压力**：大量邮件需要回复，但内容重复性高
3. **跟进遗漏**：重要邮件被淹没，忘记及时跟进
4. **信息检索困难**：历史邮件分散，需要时难以快速找到
5. **垃圾邮件干扰**：营销邮件、通知邮件占据注意力

### OpenClaw 的解决方案

- **智能分类**：自动将邮件分类为紧急、重要、普通、低优先级
- **自动回复**：对常见问题自动生成回复草稿
- **跟进管理**：自动识别需要跟进的邮件并设置提醒
- **摘要提取**：长邮件自动提取要点，节省阅读时间
- **邮件归档**：按项目、客户、主题自动整理归档

## 实现思路

智能邮件处理系统的核心组件包括：

1. **邮件连接器**：通过 IMAP/SMTP 或 Gmail API 连接邮箱
2. **内容分析器**：使用 NLP 分析邮件内容、情感和意图
3. **分类引擎**：根据规则或机器学习模型对邮件分类
4. **回复生成器**：基于邮件内容和历史回复生成回复建议
5. **工作流触发器**：根据邮件类型触发相应的处理流程

## 配置步骤

### 第一步：创建邮件连接 Skill

```yaml
# ~/.openclaw/skills/email/SKILL.md
---
name: email-assistant
description: 邮件处理助手
commands:
  - name: fetch-unread
    description: 获取未读邮件
    script: |
      curl -s "https://gmail.googleapis.com/gmail/v1/users/me/messages?q=is:unread" \
        -H "Authorization: Bearer {{secrets.gmail_token}}" | \
        jq '.messages[:20] | map({id: .id, threadId: .threadId})'

  - name: get-message
    description: 获取邮件详情
    script: |
      curl -s "https://gmail.googleapis.com/gmail/v1/users/me/messages/{{message_id}}" \
        -H "Authorization: Bearer {{secrets.gmail_token}}" | \
        jq '{
          id: .id,
          subject: (.payload.headers[] | select(.name=="Subject") | .value),
          from: (.payload.headers[] | select(.name=="From") | .value),
          to: (.payload.headers[] | select(.name=="To") | .value),
          date: (.payload.headers[] | select(.name=="Date") | .value),
          body: (.payload.parts[0].body.data // .payload.body.data | @base64d)
        }'

  - name: send-reply
    description: 发送邮件回复
    script: |
      echo '{
        "raw": "'$(echo "From: {{from}}\nTo: {{to}}\nSubject: {{subject}}\n\n{{body}}" | base64 -w 0)'"
      }' | curl -s -X POST \
        "https://gmail.googleapis.com/gmail/v1/users/me/messages/send" \
        -H "Authorization: Bearer {{secrets.gmail_token}}" \
        -H "Content-Type: application/json" \
        -d @-

  - name: apply-label
    description: 应用标签
    script: |
      curl -s -X POST \
        "https://gmail.googleapis.com/gmail/v1/users/me/messages/{{message_id}}/modify" \
        -H "Authorization: Bearer {{secrets.gmail_token}}" \
        -H "Content-Type: application/json" \
        -d '{"addLabelIds": ["{{label_id}}"]}'
```

### 第二步：创建邮件分析 Agent

```yaml
# ~/.openclaw/agents/email-analyzer.yaml
name: email-analyzer
description: 邮件内容分析专家
system_prompt: |
  你是一位专业的邮件分析师，擅长快速理解邮件意图并提取关键信息。

  分析维度：
  1. 紧急程度（紧急/高/中/低）
  2. 邮件类型（工作/通知/营销/个人/垃圾邮件）
  3. 所需行动（需回复/需处理/仅需知悉/无需处理）
  4. 情感倾向（积极/中性/消极）
  5. 关键信息提取

  输出格式（JSON）：
  {
    "urgency": "high",
    "category": "work",
    "action_required": "reply",
    "sentiment": "neutral",
    "key_points": ["要点1", "要点2"],
    "deadline": "2024-01-15",
    "suggested_response_type": "accept|decline|request_info|forward"
  }
```

### 第三步：编写邮件处理工作流

```yaml
# ~/.openclaw/workflows/email-processor.lobster
name: email-processor
version: "1.0"

triggers:
  - type: schedule
    cron: "*/15 * * * *"  # 每15分钟检查一次
  - type: webhook
    path: "/email/incoming"

steps:
  # 1. 获取未读邮件
  - name: fetch_emails
    skill: email-assistant
    command: fetch-unread

  # 2. 获取邮件详情
  - name: get_details
    skill: email-assistant
    command: get-message
    loop:
      over: "{{steps.fetch_emails.output}}"
      var: msg
    args:
      message_id: "{{msg.id}}"

  # 3. 分析每封邮件
  - name: analyze_emails
    agent: email-analyzer
    loop:
      over: "{{steps.get_details.output}}"
      var: email
    prompt: |
      请分析以下邮件：
      主题：{{email.subject}}
      发件人：{{email.from}}
      内容：{{email.body | truncate: 2000}}

  # 4. 分类处理
  - name: process_urgent
    skill: email-assistant
    command: apply-label
    loop:
      over: "{{steps.analyze_emails.output}}"
      condition: "{{item.urgency == 'urgent'}}"
    args:
      message_id: "{{item.message_id}}"
      label_id: "Label_1"  # 紧急标签

  - name: process_marketing
    skill: email-assistant
    command: apply-label
    loop:
      over: "{{steps.analyze_emails.output}}"
      condition: "{{item.category == 'marketing'}}"
    args:
      message_id: "{{item.message_id}}"
      label_id: "Label_2"  # 营销邮件标签

  # 5. 生成回复建议
  - name: generate_replies
    agent: email-writer
    loop:
      over: "{{steps.analyze_emails.output}}"
      condition: "{{item.action_required == 'reply'}}"
    prompt: |
      请为以下邮件生成回复草稿：
      原邮件主题：{{item.subject}}
      原邮件内容：{{item.body | truncate: 1000}}
      建议回复类型：{{item.suggested_response_type}}

      要求：
      1. 语气专业友好
      2. 回复简洁明了
      3. 包含必要的礼貌用语

  # 6. 创建待办事项
  - name: create_todos
    skill: todo
    command: add
    loop:
      over: "{{steps.analyze_emails.output}}"
      condition: "{{item.action_required == 'process'}}"
    args:
      title: "处理邮件：{{item.subject}}"
      due_date: "{{item.deadline}}"
      priority: "{{item.urgency}}"
      source_email: "{{item.message_id}}"

  # 7. 发送摘要通知
  - name: send_digest
    skill: notification
    command: send
    condition: "{{steps.analyze_emails.output | length > 0}}"
    args:
      channel: "{{user.preferences.notification_channel}}"
      title: "新邮件摘要（{{steps.analyze_emails.output | length}}封）"
      content: |
        紧急：{{steps.analyze_emails.output | filter: 'urgency==urgent' | length}}封
        需回复：{{steps.analyze_emails.output | filter: 'action_required==reply' | length}}封
        需处理：{{steps.analyze_emails.output | filter: 'action_required==process' | length}}封
```

### 第四步：配置邮件规则

```yaml
# ~/.openclaw/config.yaml
email:
  accounts:
    - type: gmail
      email: "your.email@gmail.com"
      token: "{{secrets.gmail_token}}"

  rules:
    - name: "老板邮件"
      condition: "from contains 'boss@company.com'"
      action: "label:urgent, notify:immediately"

    - name: "客户邮件"
      condition: "from ends_with '@client.com'"
      action: "label:client, generate_reply: true"

    - name: "内部通知"
      condition: "subject contains '[通知]'"
      action: "label:notification, archive: true"

    - name: "会议邀请"
      condition: "subject contains '会议' or subject contains '邀请'"
      action: "extract_calendar: true, suggest_response: accept"

  auto_reply_templates:
    - name: "会议确认"
      trigger: "subject contains '会议邀请'"
      template: |
        您好，

        感谢邀请。我已确认参加{{meeting_time}}的会议。

        如有变动会及时告知。

        此致
        {{user.name}}

    - name: "资料请求"
      trigger: "subject contains '资料' or subject contains '文档'"
      template: |
        您好，

        收到您的资料请求，我会在{{deadline}}前准备好相关文档并发送给您。

        如有紧急需求，请电话联系。

        此致
        {{user.name}}
```

## 实际案例

### 案例一：销售团队的客户邮件管理

销售经理小王每天收到大量客户咨询邮件，使用 OpenClaw 进行自动化处理：

```yaml
name: sales-email-processor

triggers:
  - type: schedule
    cron: "*/10 * * * *"

steps:
  - name: fetch_customer_emails
    skill: email-assistant
    command: fetch-unread
    args:
      query: "from:@customer.com OR from:@prospect.com"

  - name: classify_intent
    agent: sales-assistant
    prompt: |
      分析以下客户邮件的意图：
      {{steps.fetch_customer_emails.output}}

      分类：
      1. 询价请求
      2. 技术支持
      3. 合同相关
      4. 投诉反馈
      5. 一般咨询

      同时提取：客户名称、紧急程度、期望回复时间

  - name: route_to_team
    skill: notification
    command: send
    loop:
      over: "{{steps.classify_intent.output}}"
    args:
      channel: "slack"
      recipient: |
        {% if item.category == '技术支持' %}#tech-support
        {% elif item.category == '询价请求' %}#sales
        {% else %}#customer-service
        {% endif %}
      message: |
        新客户邮件：{{item.subject}}
        客户：{{item.customer_name}}
        分类：{{item.category}}
        紧急度：{{item.urgency}}
        链接：{{item.email_link}}

  - name: auto_reply_quote
    skill: email-assistant
    command: send-reply
    loop:
      over: "{{steps.classify_intent.output}}"
      condition: "{{item.category == '询价请求' and item.urgency == 'high'}}"
    args:
      to: "{{item.from}}"
      subject: "Re: {{item.subject}}"
      body: |
        尊敬的{{item.customer_name}}，

        感谢您的询价。我已收到您的需求，正在为您准备详细报价。

        预计{{item.expected_reply_time}}内会有专人与您联系。

        如有紧急需求，请拨打：400-xxx-xxxx

        {{user.name}}
        {{user.title}}
```

### 案例二：HR 的简历筛选助手

HR 小李需要处理大量求职邮件：

```yaml
name: hr-email-processor

triggers:
  - type: schedule
    cron: "0 9,14 * * *"

steps:
  - name: fetch_applications
    skill: email-assistant
    command: fetch-unread
    args:
      query: "subject:('应聘' OR '求职' OR '简历') has:attachment"

  - name: extract_resume
    skill: document
    command: extract-text
    loop:
      over: "{{steps.fetch_applications.output}}"

  - name: analyze_candidate
    agent: hr-assistant
    prompt: |
      分析以下求职者信息：
      邮件：{{item.body}}
      简历：{{steps.extract_resume.output}}

      请评估：
      1. 应聘岗位匹配度（1-10分）
      2. 工作经验相关性
      3. 技能匹配情况
      4. 建议：面试/待定/不合适

  - name: update_ats
    skill: ats
    command: add-candidate
    args:
      name: "{{steps.analyze_candidate.output.name}}"
      position: "{{steps.analyze_candidate.output.position}}"
      score: "{{steps.analyze_candidate.output.match_score}}"
      recommendation: "{{steps.analyze_candidate.output.recommendation}}"

  - name: send_acknowledgment
    skill: email-assistant
    command: send-reply
    args:
      to: "{{item.from}}"
      subject: "简历收到确认 - {{company.name}}"
      body: |
        您好，

        感谢您应聘{{company.name}}的{{position}}职位。

        我们已收到您的简历，HR团队会在5个工作日内进行筛选。
        如通过初筛，我们会主动与您联系安排面试。

        祝您好运！

        {{company.hr_team}}
```

### 案例三：项目经理的跟进提醒

项目经理小张需要跟踪大量项目相关邮件：

```yaml
name: project-email-tracker

triggers:
  - type: schedule
    cron: "0 9 * * *"

steps:
  - name: check_pending_replies
    skill: database
    command: query
    args:
      sql: |
        SELECT * FROM email_threads
        WHERE status = 'waiting_reply'
        AND last_activity < datetime('now', '-2 days')

  - name: generate_reminders
    agent: project-assistant
    prompt: |
      以下邮件已超过2天未收到回复，请生成跟进提醒：
      {{steps.check_pending_replies.output}}

      为每封邮件生成友好的跟进邮件草稿。

  - name: send_reminders
    skill: email-assistant
    command: send-reply
    loop:
      over: "{{steps.generate_reminders.output}}"
    args:
      to: "{{item.original_recipient}}"
      subject: "跟进：{{item.original_subject}}"
      body: "{{item.reminder_draft}}"

  - name: notify_pm
    skill: notification
    command: send
    args:
      channel: "email"
      to: "{{user.email}}"
      subject: "今日邮件跟进报告"
      content: |
        已自动发送跟进邮件：{{steps.send_reminders.output | length}}封

        详情：
        {{steps.generate_reminders.output | format_table}}
```

## 进阶技巧

### 邮件线程智能总结

```yaml
- name: summarize_thread
  agent: email-analyzer
  prompt: |
    请总结以下邮件线程的核心内容：
    {{email_thread.messages}}

    输出：
    1. 讨论主题
    2. 各方观点
    3. 当前状态
    4. 待解决问题
    5. 下一步行动建议
```

### 情感监控与预警

```yaml
- name: monitor_sentiment
  agent: sentiment-analyzer
  prompt: |
    分析以下客户邮件的情感倾向：
    {{email.body}}

    如检测到强烈负面情绪（愤怒、威胁等），立即升级处理。

- name: escalate_if_needed
  skill: notification
  command: send
  condition: "{{steps.monitor_sentiment.output.score < -0.7}}"
  args:
    channel: "slack"
    recipient: "#customer-escalation"
    message: "⚠️ 检测到高优先级客户投诉，请立即处理"
```

通过这些配置，OpenClaw 可以成为你的邮件处理助手，帮你从繁琐的邮件工作中解放出来，专注于真正重要的沟通。
